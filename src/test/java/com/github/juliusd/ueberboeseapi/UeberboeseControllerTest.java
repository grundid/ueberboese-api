package com.github.juliusd.ueberboeseapi;

import io.restassured.RestAssured;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.boot.test.web.server.LocalServerPort;

import static io.restassured.RestAssured.given;
import static org.xmlunit.matchers.CompareMatcher.isSimilarTo;

@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)
class UeberboeseControllerTest {

  @LocalServerPort
  private int port;

  @BeforeEach
  void setUp() {
    RestAssured.port = port;
  }

  @Test
  void getSourceProviders() {
    String expectedXml = """
        <?xml version='1.0' encoding='UTF-8'?>
        <SourceProvidersResponseApiDto>
          <sourceprovider>
            <sourceprovider>
              <id>1</id>
              <createdOn>1348058580.000000000</createdOn>
              <name>PANDORA</name>
              <updatedOn>1348058580.000000000</updatedOn>
            </sourceprovider>
            <sourceprovider>
              <id>2</id>
              <createdOn>1348058580.000000000</createdOn>
              <name>INTERNET_RADIO</name>
              <updatedOn>1348058580.000000000</updatedOn>
            </sourceprovider>
            <sourceprovider>
              <id>3</id>
              <createdOn>1350921780.000000000</createdOn>
              <name>OFF</name>
              <updatedOn>1350921780.000000000</updatedOn>
            </sourceprovider>
            <sourceprovider>
              <id>4</id>
              <createdOn>1350921840.000000000</createdOn>
              <name>LOCAL</name>
              <updatedOn>1350921840.000000000</updatedOn>
            </sourceprovider>
            <sourceprovider>
              <id>5</id>
              <createdOn>1350921840.000000000</createdOn>
              <name>AIRPLAY</name>
              <updatedOn>1350921840.000000000</updatedOn>
            </sourceprovider>
            <sourceprovider>
              <id>6</id>
              <createdOn>1350921840.000000000</createdOn>
              <name>CURRATED_RADIO</name>
              <updatedOn>1350921840.000000000</updatedOn>
            </sourceprovider>
            <sourceprovider>
              <id>7</id>
              <createdOn>1350921840.000000000</createdOn>
              <name>STORED_MUSIC</name>
              <updatedOn>1350921840.000000000</updatedOn>
            </sourceprovider>
            <sourceprovider>
              <id>8</id>
              <createdOn>1350921840.000000000</createdOn>
              <name>SLAVE_SOURCE</name>
              <updatedOn>1350921840.000000000</updatedOn>
            </sourceprovider>
            <sourceprovider>
              <id>9</id>
              <createdOn>1350921840.000000000</createdOn>
              <name>AUX</name>
              <updatedOn>1350921840.000000000</updatedOn>
            </sourceprovider>
            <sourceprovider>
              <id>10</id>
              <createdOn>1357811100.000000000</createdOn>
              <name>RECOMMENDED_INTERNET_RADIO</name>
              <updatedOn>1357811100.000000000</updatedOn>
            </sourceprovider>
            <sourceprovider>
              <id>11</id>
              <createdOn>1357811100.000000000</createdOn>
              <name>LOCAL_INTERNET_RADIO</name>
              <updatedOn>1357811100.000000000</updatedOn>
            </sourceprovider>
            <sourceprovider>
              <id>12</id>
              <createdOn>1357811100.000000000</createdOn>
              <name>GLOBAL_INTERNET_RADIO</name>
              <updatedOn>1357811100.000000000</updatedOn>
            </sourceprovider>
            <sourceprovider>
              <id>13</id>
              <createdOn>1395070207.000000000</createdOn>
              <name>HELLO</name>
              <updatedOn>1395070207.000000000</updatedOn>
            </sourceprovider>
            <sourceprovider>
              <id>14</id>
              <createdOn>1395070227.000000000</createdOn>
              <name>DEEZER</name>
              <updatedOn>1395070227.000000000</updatedOn>
            </sourceprovider>
            <sourceprovider>
              <id>15</id>
              <createdOn>1395070227.000000000</createdOn>
              <name>SPOTIFY</name>
              <updatedOn>1395070227.000000000</updatedOn>
            </sourceprovider>
            <sourceprovider>
              <id>16</id>
              <createdOn>1395070227.000000000</createdOn>
              <name>IHEART</name>
              <updatedOn>1395070227.000000000</updatedOn>
            </sourceprovider>
            <sourceprovider>
              <id>17</id>
              <createdOn>1417722595.000000000</createdOn>
              <name>SIRIUSXM</name>
              <updatedOn>1417722595.000000000</updatedOn>
            </sourceprovider>
            <sourceprovider>
              <id>18</id>
              <createdOn>1417722595.000000000</createdOn>
              <name>GOOGLE_PLAY_MUSIC</name>
              <updatedOn>1417722595.000000000</updatedOn>
            </sourceprovider>
            <sourceprovider>
              <id>19</id>
              <createdOn>1417722595.000000000</createdOn>
              <name>QQMUSIC</name>
              <updatedOn>1417722595.000000000</updatedOn>
            </sourceprovider>
            <sourceprovider>
              <id>20</id>
              <createdOn>1417722595.000000000</createdOn>
              <name>AMAZON</name>
              <updatedOn>1417722595.000000000</updatedOn>
            </sourceprovider>
            <sourceprovider>
              <id>21</id>
              <createdOn>1436788800.000000000</createdOn>
              <name>LOCAL_MUSIC</name>
              <updatedOn>1436788800.000000000</updatedOn>
            </sourceprovider>
            <sourceprovider>
              <id>22</id>
              <createdOn>1460136441.000000000</createdOn>
              <name>WBMX</name>
              <updatedOn>1460136441.000000000</updatedOn>
            </sourceprovider>
            <sourceprovider>
              <id>23</id>
              <createdOn>1460136441.000000000</createdOn>
              <name>SOUNDCLOUD</name>
              <updatedOn>1460136441.000000000</updatedOn>
            </sourceprovider>
            <sourceprovider>
              <id>24</id>
              <createdOn>1460136441.000000000</createdOn>
              <name>TIDAL</name>
              <updatedOn>1460136441.000000000</updatedOn>
            </sourceprovider>
            <sourceprovider>
              <id>25</id>
              <createdOn>1460136441.000000000</createdOn>
              <name>TUNEIN</name>
              <updatedOn>1460136441.000000000</updatedOn>
            </sourceprovider>
            <sourceprovider>
              <id>26</id>
              <createdOn>1466186454.000000000</createdOn>
              <name>QPLAY</name>
              <updatedOn>1466186454.000000000</updatedOn>
            </sourceprovider>
            <sourceprovider>
              <id>27</id>
              <createdOn>1470059620.000000000</createdOn>
              <name>JUKE</name>
              <updatedOn>1470059620.000000000</updatedOn>
            </sourceprovider>
            <sourceprovider>
              <id>28</id>
              <createdOn>1470059620.000000000</createdOn>
              <name>BBC</name>
              <updatedOn>1470059620.000000000</updatedOn>
            </sourceprovider>
            <sourceprovider>
              <id>29</id>
              <createdOn>1470059620.000000000</createdOn>
              <name>DARFM</name>
              <updatedOn>1470059620.000000000</updatedOn>
            </sourceprovider>
            <sourceprovider>
              <id>30</id>
              <createdOn>1470059620.000000000</createdOn>
              <name>7DIGITAL</name>
              <updatedOn>1470059620.000000000</updatedOn>
            </sourceprovider>
            <sourceprovider>
              <id>31</id>
              <createdOn>1470059620.000000000</createdOn>
              <name>SAAVN</name>
              <updatedOn>1470059620.000000000</updatedOn>
            </sourceprovider>
            <sourceprovider>
              <id>32</id>
              <createdOn>1470059620.000000000</createdOn>
              <name>RDIO</name>
              <updatedOn>1470059620.000000000</updatedOn>
            </sourceprovider>
            <sourceprovider>
              <id>33</id>
              <createdOn>1477492969.000000000</createdOn>
              <name>PHONE_MUSIC</name>
              <updatedOn>1477492969.000000000</updatedOn>
            </sourceprovider>
            <sourceprovider>
              <id>34</id>
              <createdOn>1512415127.000000000</createdOn>
              <name>ALEXA</name>
              <updatedOn>1512415127.000000000</updatedOn>
            </sourceprovider>
            <sourceprovider>
              <id>35</id>
              <createdOn>1559067680.000000000</createdOn>
              <name>RADIOPLAYER</name>
              <updatedOn>1559067680.000000000</updatedOn>
            </sourceprovider>
            <sourceprovider>
              <id>36</id>
              <createdOn>1559067701.000000000</createdOn>
              <name>RADIO.COM</name>
              <updatedOn>1559067701.000000000</updatedOn>
            </sourceprovider>
            <sourceprovider>
              <id>37</id>
              <createdOn>1560447047.000000000</createdOn>
              <name>RADIO_COM</name>
              <updatedOn>1560447047.000000000</updatedOn>
            </sourceprovider>
            <sourceprovider>
              <id>38</id>
              <createdOn>1574704833.000000000</createdOn>
              <name>SIRIUSXM_EVEREST</name>
              <updatedOn>1574704833.000000000</updatedOn>
            </sourceprovider>
          </sourceprovider>
        </SourceProvidersResponseApiDto>
        """;

    given()
        .header("Accept", "application/vnd.bose.streaming-v1.2+xml")
        .header("User-agent", "Bose_Lisa/27.0.6")
    .when()
        .get("/streaming/sourceproviders")
    .then()
        .statusCode(200)
        .contentType("application/vnd.bose.streaming-v1.2+xml")
        .body(isSimilarTo(expectedXml).ignoreWhitespace());
  }
}
